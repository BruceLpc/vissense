/*! vissense - v0.0.1 - 2014-06-19
* Copyright (c) 2014 tbk;*/
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.brwsrfyMetrics=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./node_modules/metrics/metrics"),e=a("./node_modules/metrics/reporting/report");c.Histogram=d.Histogram,c.Meter=d.Meter,c.Counter=d.Counter,c.Timer=d.Timer,c.Report=e},{"./node_modules/metrics/metrics":6,"./node_modules/metrics/reporting/report":9}],2:[function(a,b){var c=(a("./utils"),b.exports=function(a){this.content=[],this.scoreFunction=a});c.prototype={clone:function(){var a=new c(this.scoreFunction);return a.content=JSON.parse(JSON.stringify(this.content)),a},push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},peek:function(){return this.content[0]},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){for(var b=this.content.length,c=0;b>c;c++)if(this.content[c]==a){var d=this.content.pop();return c!=b-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.bubbleUp(c):this.sinkDown(c)),!0}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null;if(b>f){var h=this.content[f],i=this.scoreFunction(h);d>i&&(g=f)}if(b>e){var j=this.content[e],k=this.scoreFunction(j);(null==g?d:i)>k&&(g=e)}if(null==g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}}},{"./utils":3}],3:[function(a,b,c){c.mixin=function(){var a=function(b,c,d){for(var e in c)c.hasOwnProperty(e)&&(!d||"object"!=typeof c[e]||null===c[e]||c[e]instanceof Array?b[e]=c[e]:("undefined"==typeof b[e]&&(b[e]={}),a(b[e],c[e],d)))};return function(){var b,c,d=Array.prototype.slice.apply(arguments),e=!1;d.length>2&&"boolean"==typeof d[d.length-1]&&(e=d.pop()),b=d.shift(),c=d;for(var f=0,g=c.length;g>f;f++)a(b,c[f],e);return b}}()},{}],4:[function(a,b){var c=Math.pow(2,32),d=b.exports=function(){this.count=0,this.type="counter"};d.prototype.inc=function(a){a||(a=1),this.count+=a,this.count>c&&(this.count-=c+1)},d.prototype.dec=function(a){a||(a=1),this.count-=a,this.count<0&&(this.count=0)},d.prototype.clear=function(){this.count=0},d.prototype.printObj=function(){return{type:"counter",count:this.count}}},{}],5:[function(a,b){var c=a("../stats/exponentially_decaying_sample"),d=a("../stats/uniform_sample"),e=[.001,.01,.05,.1,.25,.5,.75,.9,.95,.98,.99,.999],f=b.exports=function(a){this.sample=a||new c(1028,.015),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0,this.type="histogram"};f.prototype.clear=function(){this.sample.clear(),this.min=null,this.max=null,this.sum=null,this.varianceM=null,this.varianceS=null,this.count=0},f.prototype.update=function(a,b){this.count++,this.sample.update(a,b),this.max=null===this.max?a:a>this.max?a:this.max,this.min=null===this.min?a:a<this.min?a:this.min,this.sum=null===this.sum?a:this.sum+a,this.updateVariance(a)},f.prototype.updateVariance=function(a){var b=this.varianceM,c=this.varianceS;1==this.count?this.varianceM=a:(this.varianceM=b+(a-b)/this.count,this.varianceS=c+(a-b)*(a-this.varianceM))},f.prototype.percentiles=function(a){a||(a=e);for(var b,c,d,f,g=this.sample.getValues().map(function(a){return parseFloat(a)}).sort(function(a,b){return a-b}),h={},i=0;i<a.length;i++)c=a[i]*(g.length+1),b=a[i],1>c?h[b]=g[0]:c>=g.length?h[b]=g[g.length-1]:(d=g[Math.floor(c)-1],f=g[Math.ceil(c)-1],h[b]=d+(c-Math.floor(c))*(f-d));return h},f.prototype.variance=function(){return this.count<1?null:this.varianceS/(this.count-1)},f.prototype.mean=function(){return 0==this.count?null:this.varianceM},f.prototype.stdDev=function(){return this.count<1?null:Math.sqrt(this.variance())},f.prototype.values=function(){return this.sample.getValues()},f.prototype.printObj=function(){var a=this.percentiles();return{type:"histogram",min:this.min,max:this.max,sum:this.sum,variance:this.variance(),mean:this.mean(),std_dev:this.stdDev(),count:this.count,median:a[.5],p75:a[.75],p95:a[.95],p99:a[.99],p999:a[.999]}},b.exports.createExponentialDecayHistogram=function(a,b){return new f(new c(a||1028,b||.015))},b.exports.createUniformHistogram=function(a){return new f(new d(a||1028))},b.exports.DEFAULT_PERCENTILES=e},{"../stats/exponentially_decaying_sample":10,"../stats/uniform_sample":13}],6:[function(a,b,c){c.Counter=a("./counter"),c.Histogram=a("./histogram"),c.Meter=a("./meter"),c.Timer=a("./timer")},{"./counter":4,"./histogram":5,"./meter":7,"./timer":8}],7:[function(a,b){var c=a("../stats/exponentially_weighted_moving_average.js"),d=b.exports=function(){this.m1Rate=c.createM1EWMA(),this.m5Rate=c.createM5EWMA(),this.m15Rate=c.createM15EWMA(),this.count=0,this.startTime=(new Date).getTime(),this.type="meter"};d.prototype.mark=function(a){a||(a=1),this.count+=a,this.m1Rate.update(a),this.m5Rate.update(a),this.m15Rate.update(a)},d.prototype.rates=function(){return{1:this.oneMinuteRate(),5:this.fiveMinuteRate(),15:this.fifteenMinuteRate(),mean:this.meanRate()}},d.prototype.fifteenMinuteRate=function(){return this.m15Rate.rate()},d.prototype.fiveMinuteRate=function(){return this.m5Rate.rate()},d.prototype.oneMinuteRate=function(){return this.m1Rate.rate()},d.prototype.meanRate=function(){return this.count/((new Date).getTime()-this.startTime)*1e3},d.prototype.printObj=function(){return{type:"meter",count:this.count,m1:this.oneMinuteRate(),m5:this.fiveMinuteRate(),m15:this.fifteenMinuteRate(),mean:this.meanRate(),unit:"seconds"}},d.prototype.tick=function(){this.m1Rate.tick(),this.m5Rate.tick(),this.m15Rate.tick()}},{"../stats/exponentially_weighted_moving_average.js":11}],8:[function(a,b){var c=a("./meter");Histogram=a("./histogram"),ExponentiallyDecayingSample=a("../stats/exponentially_decaying_sample");var d=b.exports=function(){this.meter=new c,this.histogram=new Histogram(new ExponentiallyDecayingSample(1028,.015)),this.clear(),this.type="timer"};d.prototype.update=function(a){this.histogram.update(a),this.meter.mark()},d.prototype.clear=function(){return this.histogram.clear()},d.prototype.count=function(){return this.histogram.count},d.prototype.min=function(){return this.histogram.min},d.prototype.max=function(){return this.histogram.max},d.prototype.mean=function(){return this.histogram.mean()},d.prototype.stdDev=function(){return this.histogram.stdDev()},d.prototype.percentiles=function(a){return this.histogram.percentiles(a)},d.prototype.values=function(){return this.histogram.values()},d.prototype.oneMinuteRate=function(){return this.meter.oneMinuteRate()},d.prototype.fiveMinuteRate=function(){return this.meter.fiveMinuteRate()},d.prototype.fifteenMinuteRate=function(){return this.meter.fifteenMinuteRate()},d.prototype.meanRate=function(){return this.meter.meanRate()},d.prototype.tick=function(){this.meter.tick()},d.prototype.printObj=function(){return{type:"timer",duration:this.histogram.printObj(),rate:this.meter.printObj()}}},{"../stats/exponentially_decaying_sample":10,"./histogram":5,"./meter":7}],9:[function(a,b){var c=function(a){var b=a.split("."),c=b.pop(),d=b.join(".");return{ns:d,name:c}},d=b.exports=function(a){this.trackedMetrics=a||{}};d.prototype.addMetric=function(a,b){var d=c(a);this.trackedMetrics[d.ns]||(this.trackedMetrics[d.ns]={}),this.trackedMetrics[d.ns][d.name]||(this.trackedMetrics[d.ns][d.name]=b)},d.prototype.getMetric=function(a){var b=c(a);if(this.trackedMetrics[b.ns])return this.trackedMetrics[b.ns][b.name]},d.prototype.summary=function(){var a={};for(namespace in this.trackedMetrics){a[namespace]={};for(name in this.trackedMetrics[namespace])a[namespace][name]=this.trackedMetrics[namespace][name].printObj()}return a}},{}],10:[function(a,b){var c=a("./sample"),d=a("../lib/binary_heap"),e=36e5,f=b.exports=function(a,b){this.limit=a,this.alpha=b,this.clear()};f.prototype=new c,f.prototype.getValues=function(){for(var a=[],b=this.values.clone();elt=b.pop();)a.push(elt.val);return a},f.prototype.size=function(){return this.values.size()},f.prototype.newHeap=function(){return new d(function(a){return a.priority})},f.prototype.now=function(){return(new Date).getTime()},f.prototype.tick=function(){return this.now()/1e3},f.prototype.clear=function(){this.values=this.newHeap(),this.count=0,this.startTime=this.tick(),this.nextScaleTime=this.now()+e},f.prototype.update=function(a,b){void 0==b?b=this.tick():b/=1e3;var c=this.weight(b-this.startTime)/Math.random(),d={val:a,priority:c};if(this.count<this.limit)this.count+=1,this.values.push(d);else{var e=this.values.peek();e.priority<c&&(this.values.push(d),this.values.pop())}this.now()>this.nextScaleTime&&this.rescale(this.now(),this.nextScaleTime)},f.prototype.weight=function(a){return Math.exp(this.alpha*a)},f.prototype.rescale=function(a){this.nextScaleTime=this.now()+e;var b=this.values.content,c=[],d=this.startTime;this.startTime=a&&a/1e3||this.tick();for(var f=0;f<b.length;f++)c.push({val:b[f].val,priority:b[f].priority*Math.exp(-this.alpha*(this.startTime-d))});this.values.content=c}},{"../lib/binary_heap":2,"./sample":12}],11:[function(a,b){var c=1-Math.exp(-5/60),d=1-Math.exp(-5/60/5),e=1-Math.exp(-5/60/15),f=EWMA=b.exports=function(a,b){var c=this;this.alpha=a,this.interval=b||5e3,this.initialized=!1,this.currentRate=0,this.uncounted=0,b&&(this.tickInterval=setInterval(function(){c.tick()},b),this.tickInterval.unref&&"[object Function]"==={}.toString.call(this.tickInterval.unref)&&this.tickInterval.unref())};f.prototype.update=function(a){this.uncounted+=a||1},f.prototype.tick=function(){var a=this.uncounted/this.interval;this.uncounted=0,this.initialized?this.currentRate+=this.alpha*(a-this.currentRate):(this.currentRate=a,this.initialized=!0)},f.prototype.rate=function(){return 1e3*this.currentRate},f.prototype.stop=function(){clearInterval(this.tickInterval)},b.exports.createM1EWMA=function(){return new EWMA(c,5e3)},b.exports.createM5EWMA=function(){return new EWMA(d,5e3)},b.exports.createM15EWMA=function(){return new EWMA(e,5e3)}},{}],12:[function(a,b){var c=b.exports=function(){this.values=[],this.count=0},c=b.exports=function(){};c.prototype.init=function(){this.clear()},c.prototype.update=function(a){this.values.push(a)},c.prototype.clear=function(){this.values=[],this.count=0},c.prototype.size=function(){return this.values.length},c.prototype.print=function(){console.log(this.values)},c.prototype.getValues=function(){return this.values}},{}],13:[function(a,b){var c=(a("../lib/utils"),a("./sample")),d=b.exports=function(a){this.limit=a,this.count=0,this.init()};d.prototype=new c,d.prototype.update=function(a){if(this.count++,this.size()<this.limit)this.values.push(a);else{var b=parseInt(Math.random()*this.count);b<this.limit&&(this.values[b]=a)}}},{"../lib/utils":3,"./sample":12}]},{},[1])(1)}),function(a){"use strict";var b=-1,c={onVisible:function(a){var b=c.isSupported();if(!b||!c.hidden())return a(),b;var d=c.change(function(){c.hidden()||(c.unbind(d),a())});return d},change:function(a){if(!c.isSupported())return!1;b+=1;var d=b;return c._callbacks[d]=a,c._listen(),d},unbind:function(a){delete c._callbacks[a]},afterPrerendering:function(a){var b=c.isSupported(),d="prerender";if(!b||d!=c.state())return a(),b;var e=c.change(function(b,f){d!=f&&(c.unbind(e),a())});return e},hidden:function(){return!(!c._doc.hidden&&!c._doc.webkitHidden)},state:function(){return c._doc.visibilityState||c._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!c._doc.visibilityState&&!c._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(a){var b=c.state();for(var d in c._callbacks)c._callbacks[d].call(c._doc,a,b)},_listen:function(){if(!c._init){var a="visibilitychange";c._doc.webkitVisibilityState&&(a="webkit"+a);var b=function(){c._change.apply(c,arguments)};c._doc.addEventListener?c._doc.addEventListener(a,b):c._doc.attachEvent(a,b),c._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=c:a.Visibility=c}(this),function(){"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}())}.call(this,this),function(a,b){"use strict";function c(a){var b=a.ownerDocument;return"defaultView"in b?b.defaultView:b.parentWindow}function d(a,c){return function(){return a()?c():b}}a.VisSenseUtils={_window:c,fireIf:d}}.call(this,this),function(a,b){"use strict";function c(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length;++d<f;){var g=e[d];a[g]=c?c(a[g],b[g],g,a,b):b[g]}return a}function d(){}function e(a){return a}function f(){return(new Date).getTime()}function g(b){return a.setTimeout(function(){b()},1)}function h(a){return a===Object(a)}function i(a,b){if(!h(a))return a;for(var c in Object.keys(b))void 0===a[c]&&(a[c]=b[c]);return a}b=c(b,{noop:d,identity:e,isObject:h,defaults:i,extend:c,now:f,defer:g})}.call(this,this,this.VisSenseUtils),function(a,b){"use strict";function c(b,c,e){var f="DOMContentLoaded"===c?"readystatechange":c;return b.addEventListener?(b.addEventListener(c,e,!1),d.add(b,c,e)):b.attachEvent?(b["e"+f+e]=e,b[f+e]=function(){b["e"+f+e].call(b,a.event)},b.attachEvent("on"+f,b[f+e]),d.add(b,f,e)):-1}var d=function(){var a=[],b=function(b){var c=a[b];return c[0]&&c[1]&&c[2]&&(c[0].removeEventListener?c[0].removeEventListener(c[1],c[2],c[3]):c[0].detachEvent&&(c[0].detachEvent("on"+c[1],c[2]),c[0][c[1]+c[2]]=null,c[0]["e"+c[1]+c[2]]=null)),c};return{listEvents:a,add:function(){return a.push(arguments),a.length-1},remove:b,flush:function(){var c;for(c=a.length-1;c>=0;c-=1)b(c)}}}();c(a,"unload",d.flush),b.addEvent=c}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(){return!!g}function e(){return g?!c.hidden():!0}function f(a){g&&c.change(a)}var g=!!c&&!!c.change&&!!c.isSupported&&c.isSupported();b.isPageVisibilityAPIAvailable=d,b.isPageVisible=e,b.onPageVisibilityChange=f}.call(this,this,this.VisSenseUtils,this.Visibility),function(a,b,c){"use strict";function d(a){if(!a.offsetParent){var b=g(a,"position");if("fixed"!==b)return!1}return!0}function e(a){return a.tagName&&"input"===String(a.tagName).toLowerCase()?a.type&&"hidden"===String(a.type).toLowerCase():!1}function f(a){var d=b._window(a);if("undefined"==typeof a.style)return c;if(d.getComputedStyle)return d.getComputedStyle(a,null);if(a.currentStyle)return a.currentStyle;throw new Error("cannot determine effective stylesheet in this browser")}function g(a,b){var d=f(a);if(!d)return c;var e=d[b];return"inherit"===e&&a.parentNode.style?g(a.parentNode,b):e}function h(a){var b=g(a,"display");return"none"===b?!1:a.parentNode.style?h(a.parentNode):!0}function i(a){if(a===b._window(a).document)return!0;if(!a||!a.parentNode)return!1;if(!d(a))return!1;var c=h(a);if(c!==!0)return!1;var f=g(a,"opacity");if(.01>+f)return!1;var i=g(a,"visibility");return"hidden"===i||"collapse"===i?!1:e(a)?!1:!0}!function(a){a.isHiddenInputElement=e,a.findEffectiveStyle=f,a.findEffectiveStyleProperty=g,a.isDisplayed=h,a.isVisibleByStyling=i}(b)}.call(this,this,this.VisSenseUtils),function(a,b){"use strict";function c(a){var b=a.getBoundingClientRect();return"undefined"==typeof b.height||"undefined"==typeof b.width?{top:b.top,bottom:b.bottom,left:b.left,right:b.right,height:a.clientHeight,width:a.clientWidth}:b}function d(a){var c=b._window(a);return{height:c.innerHeight||c.document.documentElement.clientHeight,width:c.innerWidth||c.document.documentElement.clientWidth}}function e(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.top>=0&&b.left>=0&&b.bottom<e.height&&b.right<e.width}function f(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.bottom>0&&b.right>0&&b.top<e.height&&b.left<e.width}b.viewport=d,b.isFullyInViewport=e,b.isInViewport=f,b._getBoundingClientRect=c}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a){if(!c.isInViewport(a)||!c.isVisibleByStyling(a)||!c.isPageVisible())return 0;var d=c._getBoundingClientRect(a);if(!d||d.height<=0||d.width<=0)return 0;var e=0,f=0,g=c.viewport(a);d.top>=0?e=b.min(d.height,g.height-d.top):d.top<0&&d.bottom>0&&(e=b.min(g.height,d.bottom)),d.left>=0?f=b.min(d.width,g.width-d.left):d.left<0&&d.right>0&&(f=b.min(g.width,d.right));var h=e*f/(d.height*d.width);return b.max(h,0)}function e(a){return c.isPageVisible()&&c.isFullyInViewport(a)&&c.isVisibleByStyling(a)}function f(a){return c.isPageVisible()&&c.isInViewport(a)&&c.isVisibleByStyling(a)}function g(a){return!f(a)}!function(a){a.percentage=d,a.isFullyVisible=e,a.isVisible=f,a.isHidden=g}(c)}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c){"use strict";var d=function(a,d){function e(){for(var a=4,b=d.createElement("div");b.innerHTML="<!--[if gt IE "+a+"]><i></i><![endif]-->",b.getElementsByTagName("i")[0];)a++;return a>4?a:c}function f(){try{return 11===d.createDocumentFragment().nodeType}catch(a){}return!1}function g(){try{return!!b.findEffectiveStyle(d.getElementsByTagName("body")[0])}catch(a){}return!1}var h={};return h.MinIEVersion=7,h.PageVisibilityAPIAvailable=b.isPageVisibilityAPIAvailable(),h.IEVersion=e(),h.DOMPresent=f(),h.CanReadStyle=g(),h.BrowserSupported=h.IEVersion>=h.MinIEVersion,h.compatible=h.DOMPresent&&h.CanReadStyle&&h.BrowserSupported,h}(a,a.document);b.support=function(){return d}}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);if(!a||1!==a.nodeType)throw new Error("InvalidArgument: not an element node");this._element=a,this._config=b||{}}d.prototype.percentage=function(){return c.percentage(this._element)},d.prototype.isFullyVisible=function(){return c.isFullyVisible(this._element)},d.prototype.isVisible=function(){return c.isVisible(this._element)},d.prototype.isHidden=function(){return c.isHidden(this._element)},d.prototype.fireIfFullyVisible=function(a){var b=this;return c.fireIf(function(){return b.isFullyVisible()},a)},d.prototype.fireIfVisible=function(a){var b=this;return c.fireIf(function(){return b.isVisible()},a)},d.prototype.fireIfHidden=function(a){var b=this;return c.fireIf(function(){return b.isHidden()},a)},d.prototype.getFullyVisibleThreshold=c.noop,a.VisSense=d}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c,d){"use strict";function e(a,b){var c=a.percentage();if(a.isHidden())return h.hidden(c,b);if(a.isFullyVisible())return h.fullyvisible(c,b);if(a.isVisible())return h.visible(c,b);throw new Error("IllegalState")}function f(b,c){for(var d in b)b.hasOwnProperty(d)&&b[d].call(c||a)}function g(a){var b=this,c=-1,d={status:null,listeners:[]};b.visobj=function(){return a},b.status=function(){return d.status},b.percentage=function(){return b.status().percentage()},b.prev=function(){return b.status().prev()},b.register=function(a){return c+=1,d.listeners[c]=a,c},b.update=function(){d.status=e(a,d.status),f(d.listeners,b)}}var h=function(){function a(a){this.isVisible=function(){return a===f.VISIBLE||this.isFullyVisible()},this.isFullyVisible=function(){return a===f.FULLY_VISIBLE},this.isHidden=function(){return a===f.HIDDEN},this.state=function(){return a}}function b(a,b){return b&&(b.prev=d.noop),a.wasVisible=function(){return!!b&&b.isVisible()},a.wasFullyVisible=function(){return!!b&&b.isFullyVisible()},a.wasHidden=function(){return!!b&&b.isHidden()},a.hasVisibilityChanged=function(){return!b||a.state()!==b.state()},a.prev=function(){return b},a}function c(a,b){return a.hasVisibilityPercentageChanged=function(){return!this.prev()||b!==this.prev().percentage()},a.percentage=function(){return b},a}function e(d,e,f){return b(c(new a(d),e),f)}var f={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2},g={};return g.hidden=function(a,b){return e(f.HIDDEN,a,b||null)},g.visible=function(a,b){return e(f.VISIBLE,a,b||null)},g.fullyvisible=function(a,b){return e(f.FULLY_VISIBLE,a,b||null)},g}();c.monitor=function(a,b){return new g(a,b||{})},c.prototype.monitor=function(a){return c.monitor(this,a)},g.prototype.fireIfVisibilityChanged=function(a){var b=this;return d.fireIf(function(){return b.status().hasVisibilityChanged()},a)},g.prototype.fireIfVisibilityPercentageChanged=function(a){var b=this;return d.fireIf(function(){return b.status().hasVisibilityPercentageChanged()},a)},g.prototype.onVisibilityChange=function(a){return this.register(this.fireIfVisibilityChanged(a))},g.prototype.onVisibilityPercentageChange=function(a){return this.register(this.fireIfVisibilityPercentageChanged(a))},g.prototype.onVisible=function(a){var b=this,c=d.fireIf(function(){return b.status().isVisible()},a),e=this.fireIfVisibilityChanged(d.fireIf(function(){return!b.status().prev()||b.status().wasHidden()},c));return this.register(e)},g.prototype.onFullyVisible=function(a){var b=this,c=d.fireIf(function(){return b.status().isFullyVisible()},a),e=this.fireIfVisibilityChanged(c);return this.register(e)},g.prototype.onHidden=function(a){var b=this,c=d.fireIf(function(){return b.status().isHidden()},a),e=this.fireIfVisibilityChanged(c);return this.register(e)},g.prototype.on=function(a,b){var c={hidden:this.onHidden,visible:this.onVisible,fullyvisible:this.onFullyVisible,percentagechange:this.onVisibilityPercentageChange,visibilitychange:this.onVisibilityChange};if(!c[a])throw new Error('VisMon: Event "'+a+'" is not supported');return c[a](b)}}.call(this,this,this.Math,this.VisSense,this.VisSenseUtils),function(a,b,c){"use strict";function d(a){clearInterval(a.id),clearTimeout(a.delay),delete a.id,delete a.delay}function e(b,c,d){var e=function(){b.last=new Date,b.callback.call(a)};if(d){var f=new Date,g=f-b.last;c>g?b.delay=setTimeout(function(){e(),b.id=setInterval(e,c)},c-g):(e(),b.id=setInterval(e,c))}else b.id=setInterval(e,c)}function f(b){function g(a,c){var d,f=l.timers[a];if(b.status().isHidden()){if(null===f.hidden)return;d=f.hidden}else d=f.visible;e(f,d,c)}function h(a){d(l.timers[a])}function i(){var a=b.status().isHidden(),c=b.status().wasHidden();if(a&&!c||!a&&c)for(var d in l.timers)if(l.timers.hasOwnProperty(d)){h(d);var e=!0;g(d,a?e:!0)}}var j=this,k=-1,l={timers:{},initialized:!1};j.vismon=function(){return b},f.prototype.every=function(a,b,c){c||(c=b,b=null),k+=1;var d=k;return l.timers[d]={visible:a,hidden:b,callback:c},g(d,!1),d},f.prototype.stop=function(a){return l.timers[a]?(h(a),delete l.timers[a],!0):!1},f.prototype.stopAll=function(){for(var a in l.timers)l.timers.hasOwnProperty(a)&&h(a);l.timers=[]},function(){var d=function(){b.update()};!function(){var e=["readystatechange","scroll","resize"];c.onPageVisibilityChange(d);for(var f in e)e.hasOwnProperty(f)&&c.addEvent(a,e[f],d);c.addEvent(b.visobj()._element,"mousemove",d)}(),b.onVisible(function(){i()}),b.onHidden(function(){i()}),b.update(),c.defer(function(){i(),c.defer(d)}),j.every(100,100,d)}()}function g(a,b){return new f(a.monitor(),b||{})}b.timer=g,b.prototype.timer=function(a){return g(this,a)}}.call(this,this,this.VisSense,this.VisSenseUtils),function(a,b){"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),function(a){a.performance||(a.performance=a.performance||{},a.performance.now=a.performance.now||a.performance.mozNow||a.performance.msNow||a.performance.oNow||a.performance.webkitNow||Date.now)}(a);var c=function(a){function b(a){var b=this,d={ts:0,te:0,r:!1},e=b.now=c(a);b.start=function(a){return d.r=!0,d.ts=+a||e(),0},b.restart=function(a){return b.stopAndRestartIf(!0,a)},b.stop=function(a){return b.stopIf(d.r,a)},b.running=function(){return d.r},b.stopIf=function(a,c){var e=b.time(c);return a&&(d.r=!1),e},b.time=function(a){return d.r?(d.te=+a||e(),d.te-d.ts):0},b.stopAndRestartIf=function(a,c){return a?b.stopAndThenRestartIf(!0,c):0},b.stopAndThenRestartIf=function(a,c){var d=b.stop(c);return a&&b.start(c),d}}var c=function(a){return function(b){return b?a.performance.now:Date.now}}(a);return b.now=function(a){return c(a)()},b}(a);b.newStopWatch=function(){return new c}}.call(this,this,this.VisSenseUtils),function(a,b,c,d){"use strict";function e(a,b){a>0&&b(a)}function f(a,b){function f(){if(l.updatePercentageOnPageHidden||c.isPageVisible()){var b=a.vismon().status().percentage();m.getMetric("percentage").update(b)}}function g(){var b=a.vismon().status().state();m.getMetric("visibility.changes").update(b)}function h(a){var b=a.status(),c=n.stopAndThenRestartIf(b.isVisible());e(c,function(a){m.getMetric("time.visible").inc(a),m.getMetric("time.relativeVisible").inc(a*b.percentage())}),e(o.stopAndThenRestartIf(b.isFullyVisible()),function(a){m.getMetric("time.fullyvisible").inc(a)}),e(p.stopAndThenRestartIf(b.isHidden()),function(a){m.getMetric("time.hidden").inc(a)}),e(q.restart(),function(a){m.getMetric("time.duration").inc(a)})}var j=this,k=!1,l=i(b),m=new d.Report,n=c.newStopWatch(),o=c.newStopWatch(),p=c.newStopWatch(),q=c.newStopWatch();m.addMetric("time.visible",new d.Counter),m.addMetric("time.fullyvisible",new d.Counter),m.addMetric("time.hidden",new d.Counter),m.addMetric("time.relativeVisible",new d.Counter),m.addMetric("time.duration",new d.Counter),m.addMetric("visibility.changes",new d.Timer),m.addMetric("percentage",new d.Timer),f(),g(),a.vismon().onVisibilityPercentageChange(function(){k||(f(),h(a.vismon()))}),a.vismon().onVisibilityChange(function(){!k&&c.isPageVisible()&&g()}),a.every(l.visibleUpdateInterval,l.hiddenUpdateInterval,function(){!k&&c.isPageVisible()&&(f(),h(a.vismon()))}),j.getMetric=function(a){return m.getMetric(a)},j.summary=function(){return m.summary()},j.stopped=function(){return k},j.stop=function(){return f(),h(a.vismon()),a.stopAll(),k=!0}}function g(a,b){return new f(a.timer(),b)}var h={visibleUpdateInterval:200,hiddenUpdateInterval:200,updatePercentageOnPageHidden:!1},i=function(a){if(a&&(a.visibleUpdateInterval<1||a.hiddenUpdateInterval<1))throw new Error("InvalidArgument: update interval needs to be positive.");return c.defaults(a,h)};b.metrics=g,b.prototype.metrics=function(a){return g(this,a)}}.call(this,this,this.VisSense,this.VisSenseUtils,this.brwsrfyMetrics);