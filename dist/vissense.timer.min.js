/*! vissense - v0.0.1 - 2014-06-19
* Copyright (c) 2014 tbk;*/
!function(a){"use strict";var b=-1,c={onVisible:function(a){var b=c.isSupported();if(!b||!c.hidden())return a(),b;var d=c.change(function(){c.hidden()||(c.unbind(d),a())});return d},change:function(a){if(!c.isSupported())return!1;b+=1;var d=b;return c._callbacks[d]=a,c._listen(),d},unbind:function(a){delete c._callbacks[a]},afterPrerendering:function(a){var b=c.isSupported(),d="prerender";if(!b||d!=c.state())return a(),b;var e=c.change(function(b,f){d!=f&&(c.unbind(e),a())});return e},hidden:function(){return!(!c._doc.hidden&&!c._doc.webkitHidden)},state:function(){return c._doc.visibilityState||c._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!c._doc.visibilityState&&!c._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(a){var b=c.state();for(var d in c._callbacks)c._callbacks[d].call(c._doc,a,b)},_listen:function(){if(!c._init){var a="visibilitychange";c._doc.webkitVisibilityState&&(a="webkit"+a);var b=function(){c._change.apply(c,arguments)};c._doc.addEventListener?c._doc.addEventListener(a,b):c._doc.attachEvent(a,b),c._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=c:a.Visibility=c}(this),function(){"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}())}.call(this,this),function(a,b){"use strict";function c(a){var b=a.ownerDocument;return"defaultView"in b?b.defaultView:b.parentWindow}function d(a,c){return function(){return a()?c():b}}a.VisSenseUtils={_window:c,fireIf:d}}.call(this,this),function(a,b){"use strict";function c(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length;++d<f;){var g=e[d];a[g]=c?c(a[g],b[g],g,a,b):b[g]}return a}function d(){}function e(a){return a}function f(){return(new Date).getTime()}function g(b){return a.setTimeout(function(){b()},1)}function h(a){return a===Object(a)}function i(a,b){if(!h(a))return a;for(var c in Object.keys(b))void 0===a[c]&&(a[c]=b[c]);return a}b=c(b,{noop:d,identity:e,isObject:h,defaults:i,extend:c,now:f,defer:g})}.call(this,this,this.VisSenseUtils),function(a,b){"use strict";function c(b,c,e){var f="DOMContentLoaded"===c?"readystatechange":c;return b.addEventListener?(b.addEventListener(c,e,!1),d.add(b,c,e)):b.attachEvent?(b["e"+f+e]=e,b[f+e]=function(){b["e"+f+e].call(b,a.event)},b.attachEvent("on"+f,b[f+e]),d.add(b,f,e)):-1}var d=function(){var a=[],b=function(b){var c=a[b];return c[0]&&c[1]&&c[2]&&(c[0].removeEventListener?c[0].removeEventListener(c[1],c[2],c[3]):c[0].detachEvent&&(c[0].detachEvent("on"+c[1],c[2]),c[0][c[1]+c[2]]=null,c[0]["e"+c[1]+c[2]]=null)),c};return{listEvents:a,add:function(){return a.push(arguments),a.length-1},remove:b,flush:function(){var c;for(c=a.length-1;c>=0;c-=1)b(c)}}}();c(a,"unload",d.flush),b.addEvent=c}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(){return!!g}function e(){return g?!c.hidden():!0}function f(a){g&&c.change(a)}var g=!!c&&!!c.change&&!!c.isSupported&&c.isSupported();b.isPageVisibilityAPIAvailable=d,b.isPageVisible=e,b.onPageVisibilityChange=f}.call(this,this,this.VisSenseUtils,this.Visibility),function(a,b,c){"use strict";function d(a){if(!a.offsetParent){var b=g(a,"position");if("fixed"!==b)return!1}return!0}function e(a){return a.tagName&&"input"===String(a.tagName).toLowerCase()?a.type&&"hidden"===String(a.type).toLowerCase():!1}function f(a){var d=b._window(a);if("undefined"==typeof a.style)return c;if(d.getComputedStyle)return d.getComputedStyle(a,null);if(a.currentStyle)return a.currentStyle;throw new Error("cannot determine effective stylesheet in this browser")}function g(a,b){var d=f(a);if(!d)return c;var e=d[b];return"inherit"===e&&a.parentNode.style?g(a.parentNode,b):e}function h(a){var b=g(a,"display");return"none"===b?!1:a.parentNode.style?h(a.parentNode):!0}function i(a){if(a===b._window(a).document)return!0;if(!a||!a.parentNode)return!1;if(!d(a))return!1;var c=h(a);if(c!==!0)return!1;var f=g(a,"opacity");if(.01>+f)return!1;var i=g(a,"visibility");return"hidden"===i||"collapse"===i?!1:e(a)?!1:!0}!function(a){a.isHiddenInputElement=e,a.findEffectiveStyle=f,a.findEffectiveStyleProperty=g,a.isDisplayed=h,a.isVisibleByStyling=i}(b)}.call(this,this,this.VisSenseUtils),function(a,b){"use strict";function c(a){var b=a.getBoundingClientRect();return"undefined"==typeof b.height||"undefined"==typeof b.width?{top:b.top,bottom:b.bottom,left:b.left,right:b.right,height:a.clientHeight,width:a.clientWidth}:b}function d(a){var c=b._window(a);return{height:c.innerHeight||c.document.documentElement.clientHeight,width:c.innerWidth||c.document.documentElement.clientWidth}}function e(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.top>=0&&b.left>=0&&b.bottom<e.height&&b.right<e.width}function f(a){var b=c(a);if(b&&(b.width<=0||b.height<=0))return!1;var e=d(a);return!!b&&b.bottom>0&&b.right>0&&b.top<e.height&&b.left<e.width}b.viewport=d,b.isFullyInViewport=e,b.isInViewport=f,b._getBoundingClientRect=c}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a){if(!c.isInViewport(a)||!c.isVisibleByStyling(a)||!c.isPageVisible())return 0;var d=c._getBoundingClientRect(a);if(!d||d.height<=0||d.width<=0)return 0;var e=0,f=0,g=c.viewport(a);d.top>=0?e=b.min(d.height,g.height-d.top):d.top<0&&d.bottom>0&&(e=b.min(g.height,d.bottom)),d.left>=0?f=b.min(d.width,g.width-d.left):d.left<0&&d.right>0&&(f=b.min(g.width,d.right));var h=e*f/(d.height*d.width);return b.max(h,0)}function e(a){return c.isPageVisible()&&c.isFullyInViewport(a)&&c.isVisibleByStyling(a)}function f(a){return c.isPageVisible()&&c.isInViewport(a)&&c.isVisibleByStyling(a)}function g(a){return!f(a)}!function(a){a.percentage=d,a.isFullyVisible=e,a.isVisible=f,a.isHidden=g}(c)}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c){"use strict";var d=function(a,d){function e(){for(var a=4,b=d.createElement("div");b.innerHTML="<!--[if gt IE "+a+"]><i></i><![endif]-->",b.getElementsByTagName("i")[0];)a++;return a>4?a:c}function f(){try{return 11===d.createDocumentFragment().nodeType}catch(a){}return!1}function g(){try{return!!b.findEffectiveStyle(d.getElementsByTagName("body")[0])}catch(a){}return!1}var h={};return h.MinIEVersion=7,h.PageVisibilityAPIAvailable=b.isPageVisibilityAPIAvailable(),h.IEVersion=e(),h.DOMPresent=f(),h.CanReadStyle=g(),h.BrowserSupported=h.IEVersion>=h.MinIEVersion,h.compatible=h.DOMPresent&&h.CanReadStyle&&h.BrowserSupported,h}(a,a.document);b.support=function(){return d}}.call(this,this,this.VisSenseUtils),function(a,b,c){"use strict";function d(a,b){if(!(this instanceof d))return new d(a,b);if(!a||1!==a.nodeType)throw new Error("InvalidArgument: not an element node");this._element=a,this._config=b||{}}d.prototype.percentage=function(){return c.percentage(this._element)},d.prototype.isFullyVisible=function(){return c.isFullyVisible(this._element)},d.prototype.isVisible=function(){return c.isVisible(this._element)},d.prototype.isHidden=function(){return c.isHidden(this._element)},d.prototype.fireIfFullyVisible=function(a){var b=this;return c.fireIf(function(){return b.isFullyVisible()},a)},d.prototype.fireIfVisible=function(a){var b=this;return c.fireIf(function(){return b.isVisible()},a)},d.prototype.fireIfHidden=function(a){var b=this;return c.fireIf(function(){return b.isHidden()},a)},d.prototype.getFullyVisibleThreshold=c.noop,a.VisSense=d}.call(this,this,this.Math,this.VisSenseUtils),function(a,b,c,d){"use strict";function e(a,b){var c=a.percentage();if(a.isHidden())return h.hidden(c,b);if(a.isFullyVisible())return h.fullyvisible(c,b);if(a.isVisible())return h.visible(c,b);throw new Error("IllegalState")}function f(b,c){for(var d in b)b.hasOwnProperty(d)&&b[d].call(c||a)}function g(a){var b=this,c=-1,d={status:null,listeners:[]};b.visobj=function(){return a},b.status=function(){return d.status},b.percentage=function(){return b.status().percentage()},b.prev=function(){return b.status().prev()},b.register=function(a){return c+=1,d.listeners[c]=a,c},b.update=function(){d.status=e(a,d.status),f(d.listeners,b)}}var h=function(){function a(a){this.isVisible=function(){return a===f.VISIBLE||this.isFullyVisible()},this.isFullyVisible=function(){return a===f.FULLY_VISIBLE},this.isHidden=function(){return a===f.HIDDEN},this.state=function(){return a}}function b(a,b){return b&&(b.prev=d.noop),a.wasVisible=function(){return!!b&&b.isVisible()},a.wasFullyVisible=function(){return!!b&&b.isFullyVisible()},a.wasHidden=function(){return!!b&&b.isHidden()},a.hasVisibilityChanged=function(){return!b||a.state()!==b.state()},a.prev=function(){return b},a}function c(a,b){return a.hasVisibilityPercentageChanged=function(){return!this.prev()||b!==this.prev().percentage()},a.percentage=function(){return b},a}function e(d,e,f){return b(c(new a(d),e),f)}var f={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2},g={};return g.hidden=function(a,b){return e(f.HIDDEN,a,b||null)},g.visible=function(a,b){return e(f.VISIBLE,a,b||null)},g.fullyvisible=function(a,b){return e(f.FULLY_VISIBLE,a,b||null)},g}();c.monitor=function(a,b){return new g(a,b||{})},c.prototype.monitor=function(a){return c.monitor(this,a)},g.prototype.fireIfVisibilityChanged=function(a){var b=this;return d.fireIf(function(){return b.status().hasVisibilityChanged()},a)},g.prototype.fireIfVisibilityPercentageChanged=function(a){var b=this;return d.fireIf(function(){return b.status().hasVisibilityPercentageChanged()},a)},g.prototype.onVisibilityChange=function(a){return this.register(this.fireIfVisibilityChanged(a))},g.prototype.onVisibilityPercentageChange=function(a){return this.register(this.fireIfVisibilityPercentageChanged(a))},g.prototype.onVisible=function(a){var b=this,c=d.fireIf(function(){return b.status().isVisible()},a),e=this.fireIfVisibilityChanged(d.fireIf(function(){return!b.status().prev()||b.status().wasHidden()},c));return this.register(e)},g.prototype.onFullyVisible=function(a){var b=this,c=d.fireIf(function(){return b.status().isFullyVisible()},a),e=this.fireIfVisibilityChanged(c);return this.register(e)},g.prototype.onHidden=function(a){var b=this,c=d.fireIf(function(){return b.status().isHidden()},a),e=this.fireIfVisibilityChanged(c);return this.register(e)},g.prototype.on=function(a,b){var c={hidden:this.onHidden,visible:this.onVisible,fullyvisible:this.onFullyVisible,percentagechange:this.onVisibilityPercentageChange,visibilitychange:this.onVisibilityChange};if(!c[a])throw new Error('VisMon: Event "'+a+'" is not supported');return c[a](b)}}.call(this,this,this.Math,this.VisSense,this.VisSenseUtils),function(a,b,c){"use strict";function d(a){clearInterval(a.id),clearTimeout(a.delay),delete a.id,delete a.delay}function e(b,c,d){var e=function(){b.last=new Date,b.callback.call(a)};if(d){var f=new Date,g=f-b.last;c>g?b.delay=setTimeout(function(){e(),b.id=setInterval(e,c)},c-g):(e(),b.id=setInterval(e,c))}else b.id=setInterval(e,c)}function f(b){function g(a,c){var d,f=l.timers[a];if(b.status().isHidden()){if(null===f.hidden)return;d=f.hidden}else d=f.visible;e(f,d,c)}function h(a){d(l.timers[a])}function i(){var a=b.status().isHidden(),c=b.status().wasHidden();if(a&&!c||!a&&c)for(var d in l.timers)if(l.timers.hasOwnProperty(d)){h(d);var e=!0;g(d,a?e:!0)}}var j=this,k=-1,l={timers:{},initialized:!1};j.vismon=function(){return b},f.prototype.every=function(a,b,c){c||(c=b,b=null),k+=1;var d=k;return l.timers[d]={visible:a,hidden:b,callback:c},g(d,!1),d},f.prototype.stop=function(a){return l.timers[a]?(h(a),delete l.timers[a],!0):!1},f.prototype.stopAll=function(){for(var a in l.timers)l.timers.hasOwnProperty(a)&&h(a);l.timers=[]},function(){var d=function(){b.update()};!function(){var e=["readystatechange","scroll","resize"];c.onPageVisibilityChange(d);for(var f in e)e.hasOwnProperty(f)&&c.addEvent(a,e[f],d);c.addEvent(b.visobj()._element,"mousemove",d)}(),b.onVisible(function(){i()}),b.onHidden(function(){i()}),b.update(),c.defer(function(){i(),c.defer(d)}),j.every(100,100,d)}()}function g(a,b){return new f(a.monitor(),b||{})}b.timer=g,b.prototype.timer=function(a){return g(this,a)}}.call(this,this,this.VisSense,this.VisSenseUtils);