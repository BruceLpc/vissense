/*! { "name": "vissense", "version": "0.2.1", "homepage": "https://vissense.github.io/vissense","copyright": "(c) 2015 tbk" } */
!function(a,b){"use strict";a.VisSense=b(a,a.document)}(this,function(a,b,c){"use strict";function d(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function e(a,b){if(!n(a))return b;for(var c=Object.keys(b),d=0,e=c.length;e>d;d++){var f=c[d];void 0===a[f]&&(a[f]=b[f])}return a}function f(b){return a.setTimeout(function(){b()},0)}function g(a,b){return function(){return(m(a)?a():a)?b():c}}function h(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length,g=m(c);++d<f;){var h=e[d];a[h]=g?c(a[h],b[h],h,a,b):b[h]}return a}function i(a){return a}function j(a){return a!==c}function k(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"===Object.prototype.toString.call(a)||!1}function l(a){return a&&1===a.nodeType||!1}function m(a){return"function"==typeof a||!1}function n(a){var b=typeof a;return"function"===b||a&&"object"===b||!1}function o(){}function p(){return(new Date).getTime()}function q(){return{height:a.innerHeight,width:a.innerWidth}}function r(b){return a.getComputedStyle(b,null)}function s(a,b){return a.getPropertyValue(b)}function t(a,b){b||(b=r(a));var c=s(b,"display");if("none"===c)return!1;var d=s(b,"visibility");return"hidden"===d||"collapse"===d?!1:a.parentNode&&a.parentNode.style?t(a.parentNode,r(a)):!0}function u(a){if(a===b)return!0;if(!a||!a.parentNode)return!1;var c=r(a),d=t(a,c);return d!==!0?!1:!0}function v(a,b){return!a||a.width<=0||a.height<=0?!1:a.bottom>0&&a.right>0&&a.top<b.height&&a.left<b.width}function w(a){if(!x())return 0;var b=a.getBoundingClientRect(),c=q();if(!v(b,c)||!u(a))return 0;var d=0,e=0;return b.top>=0?d=Math.min(b.height,c.height-b.top):b.bottom>0&&(d=Math.min(c.height,b.bottom)),b.left>=0?e=Math.min(b.width,c.width-b.left):b.right>0&&(e=Math.min(c.width,b.right)),Math.round(d*e/(b.height*b.width)*1e3)/1e3}function x(){return C?!b[C[0]]:!0}function y(a,b){if(!(this instanceof y))return new y(a,b);if(!l(a))throw new Error("not an element node");this._element=a,this._config=e(b,{fullyvisible:1,hidden:0,getVisiblePercentage:w})}function z(a,b){var c=a.state(),d=c.percentage;return b&&d===b.percentage&&b.percentage===b.previous.percentage?b:c.hidden?y.VisState.hidden(d,b):c.fullyvisible?y.VisState.fullyvisible(d,b):y.VisState.visible(d,b)}function A(b,c){for(var d=0,e=b.length;e>d;d++)b[d].call(c||a)}function B(a,b){var c=this,d=e(b,{strategy:[new B.Strategy.PollingStrategy,new B.Strategy.EventStrategy]}),f=k(d.strategy)?d.strategy:[d.strategy];c._strategy=new B.Strategy.CompositeStrategy(f),c._visobj=a,c._state={},c._listeners=[],c._events=["update","hidden","visible","fullyvisible","percentagechange","visibilitychange"];for(var g=0,h=c._events.length;h>g;g++)d[c._events[g]]&&c.on(c._events[g],d[c._events[g]])}var C=function(a){for(var c="visibilitychange",d=[["hidden",c],["mozHidden","moz"+c],["webkitHidden","webkit"+c],["msHidden","ms"+c]],e=0,f=d.length;f>e;e++)if(b[d[e][0]]!==a)return d[e]}();y.prototype.state=function(){var a=this._config.getVisiblePercentage(this._element);return a<=this._config.hidden?y.VisState.hidden(a):a>=this._config.fullyvisible?y.VisState.fullyvisible(a):y.VisState.visible(a)},y.prototype.percentage=function(){return this.state().percentage},y.prototype.isFullyVisible=function(){return this.state().fullyvisible},y.prototype.isVisible=function(){return this.state().visible},y.prototype.isHidden=function(){return this.state().hidden},y.fn=y.prototype,y.of=function(a,b){return new y(a,b)};var D={HIDDEN:[0,"hidden"],VISIBLE:[1,"visible"],FULLY_VISIBLE:[2,"fullyvisible"]};return y.VisState=function(){function a(a,b,c){return c&&delete c.previous,{code:a[0],state:a[1],percentage:b,previous:c||{},fullyvisible:a[0]===D.FULLY_VISIBLE[0],visible:a[0]===D.VISIBLE[0]||a[0]===D.FULLY_VISIBLE[0],hidden:a[0]===D.HIDDEN[0]}}return{hidden:function(b,c){return a(D.HIDDEN,b,c)},visible:function(b,c){return a(D.VISIBLE,b,c)},fullyvisible:function(b,c){return a(D.FULLY_VISIBLE,b,c)}}}(),B.prototype.visobj=function(){return this._visobj},B.prototype.state=function(){return this._state},B.prototype.start=function(){return this._strategy.start(this),this},B.prototype.stop=function(){return this._strategy.stop(this)},B.prototype.use=function(a){return this.stop(),this._strategy=a,this.start()},B.prototype.update=function(){this._state=z(this._visobj,this._state),A(this._listeners,this)},B.prototype.onUpdate=function(a){if(!m(a))return o;var b=a.bind(c,this);this._listeners.push(b);var d=this;return function(){var a=d._listeners.indexOf(b);return a>-1?(d._listeners.splice(a,1),!0):!1}},B.prototype.onVisibilityChange=function(a){var b=this;return this.onUpdate(function(){b._state.code!==b._state.previous.code&&a(b)})},B.prototype.onPercentageChange=function(a){var b=this;return this.onUpdate(function(){var c=b._state.percentage,d=b._state.previous.percentage;c!==d&&a(c,d,b)})},B.prototype.onVisible=function(a){var b=this;return b.onVisibilityChange(g(function(){return b._state.previous.hidden&&b._state.visible},a))},B.prototype.onFullyVisible=function(a){var b=this;return b.onVisibilityChange(g(function(){return b._state.fullyvisible},a))},B.prototype.onHidden=function(a){var b=this;return b.onVisibilityChange(g(function(){return b._state.hidden},a))},B.prototype.on=function(a,b){var c=this;switch(a){case"update":return c.onUpdate(b);case"hidden":return c.onHidden(b);case"visible":return c.onVisible(b);case"fullyvisible":return c.onFullyVisible(b);case"percentagechange":return c.onPercentageChange(b);case"visibilitychange":return c.onVisibilityChange(b)}return o},B.Strategy=function(){},B.Strategy.prototype.start=function(){throw new Error("Strategy#start needs to be overridden.")},B.Strategy.prototype.stop=function(){throw new Error("Strategy#stop needs to be overridden.")},B.Strategy.NoopStrategy=function(){},B.Strategy.NoopStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.NoopStrategy.prototype.start=function(a){a.update()},B.Strategy.NoopStrategy.prototype.stop=function(){},B.Strategy.CompositeStrategy=function(a){this._strategies=k(a)?a:[],this._started=!1},B.Strategy.CompositeStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.CompositeStrategy.prototype.start=function(a){for(var b=0,c=this._strategies.length;c>b;b++)this._strategies[b].start(a)},B.Strategy.CompositeStrategy.prototype.stop=function(a){for(var b=0,c=this._strategies.length;c>b;b++)this._strategies[b].stop(a)},B.Strategy.PollingStrategy=function(a){this._config=e(a,{interval:1e3}),this._started=!1},B.Strategy.PollingStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.PollingStrategy.prototype.start=function(a){if(!this._started){var b=this;!function c(){a.update(),b._timeoutId=setTimeout(c,b._config.interval)}(),this._started=!0}return this._started},B.Strategy.PollingStrategy.prototype.stop=function(){return this._started?(clearTimeout(this._timeoutId),this._started=!1,!0):!1},B.Strategy.EventStrategy=function(a){this._config=e(a,{debounce:50}),this._started=!1},B.Strategy.EventStrategy.prototype=Object.create(B.Strategy.prototype),B.Strategy.EventStrategy.prototype.start=function(a){var b=this;return b._started||(b._update=d(function(){a.update()},b._config.debounce),C&&addEventListener(C[1],b._update),addEventListener("scroll",b._update),addEventListener("resize",b._update),b._update(),b._started=!0),this._started},B.Strategy.EventStrategy.prototype.stop=function(){var a=this;return a._started?(removeEventListener("resize",a._update),removeEventListener("scroll",a._update),C&&removeEventListener(C[1],a._update),a._started=!1,!0):!1},y.VisMon=B,y.fn.monitor=function(a){return new B(this,a)},y.Utils={debounce:d,defaults:e,defer:f,extend:h,fireIf:g,identity:i,isArray:k,isDefined:j,isElement:l,isFunction:m,isObject:n,isPageVisible:x,isVisibleByStyling:u,noop:o,now:p,percentage:w,_viewport:q,_isInViewport:v,_isDisplayed:t,_computedStyle:r,_styleProperty:s},y});