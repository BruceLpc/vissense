/*! vissense - v0.0.1 - 2014-06-16
* Copyright (c) 2014 tbk;*/
!function(a,b){"use strict";a.VISSENSE=b(a,document,a.VISSENSE||{})}(this,function(a,b,c){"use strict";var d=function(){var a=[];return{listEvents:a,add:function(){a.push(arguments)},flush:function(){var b,c;for(b=a.length-1;b>=0;b-=1)c=a[b],c[0].removeEventListener&&c[0].removeEventListener(c[1],c[2],c[3]),"on"!==c[1].substring(0,2)&&(c[1]="on"+c[1]),c[0].detachEvent&&c[0].detachEvent(c[1],c[2]),c[0][c[1]]=null}}}();return c.addEvent=function(b,c,e){var f="DOMContentLoaded"===c?"readystatechange":c;b.addEventListener?(b.addEventListener(c,e,!1),d.add(b,c,e)):b.attachEvent?(b["e"+f+e]=e,b[f+e]=function(){b["e"+f+e](a.event)},b.attachEvent("on"+f,b[f+e]),d.add(b,f,e)):b["on"+f]=b["e"+f+e]},c.addEvent(a,"unload",d.flush),c}),function(a,b){"use strict";a.VISSENSE=b(a,document,a.VISSENSE||{})}(this,function(a,b,c,d){"use strict";return c.IE_VERSION=function(){for(var a=3,c=b.createElement("div");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c.getElementsByTagName("i")[0];);return a>4?a:d}(),c}),function(a,b){"use strict";a.VISSENSE=b(a,document,a.VISSENSE||{})}(this,function(a,b,c,d){"use strict";var e=function(a){var b=a.ownerDocument;return"defaultView"in b?b.defaultView:b.parentWindow},f=function(a){var b=e(a);if(a.style===d)return d;if(b.getComputedStyle)return b.getComputedStyle(a,null);if(a.currentStyle)return a.currentStyle;throw new Error("cannot determine effective stylesheet in this browser")},g=function j(a,b){var c=f(a),d=c[b];return"inherit"===d&&a.parentNode.style?j(a.parentNode,b):d},h=function k(a){var b=g(a,"display");return"none"===b?!1:a.parentNode.style?k(a.parentNode):!0},i=function(a){return a.tagName&&"input"===String(a.tagName).toLowerCase()?a.type&&"hidden"===String(a.type).toLowerCase():!1};return c.findEffectiveStyleProperty=function(a,b){return g(a,b)},c.isVisibleByStyling=function(a){if(a===e(a).document)return!0;if(!a||!a.parentNode)return!1;if(i(a))return!1;var b=g(a,"visibility"),c=h(a);return"hidden"!==b&&"collapse"!==b&&c},c}),function(a,b){"use strict";a.VISSENSE=b(a,document,a.VISSENSE||{})}(this,function(a,b,c){"use strict";var d=function(a){var b=a.ownerDocument;return"defaultView"in b?b.defaultView:b.parentWindow},e=function(a){var b=a.getBoundingClientRect();return"undefined"==typeof b.height||"undefined"==typeof b.width?{top:b.top,bottom:b.bottom,left:b.left,right:b.right,height:a.clientHeight,width:a.clientWidth}:b},f=function(a){var b=d(a);return b.innerHeight||b.document.documentElement.clientHeight},g=function(a){var b=d(a);return b.innerWidth||b.document.documentElement.clientWidth};return c.isFullyInViewport=function(a){var b=e(a);return b&&(b.width<=0||b.height<=0)?!1:!!b&&b.top>=0&&b.left>=0&&b.bottom<f(a)&&b.right<g(a)},c.isInViewport=function(a){var b=e(a);return b&&(b.width<=0||b.height<=0)?!1:!!b&&b.bottom>0&&b.right>0&&b.top<f(a)&&b.left<g(a)},c.getVisibilityPercentage=function(a){if(!c.isInViewport(a))return 0;var b=e(a);if(!b||b.height<=0||b.width<=0)return 0;var d=0,h=0;b.top>=0?d=Math.min(b.height,f(a)-b.top):b.top<0&&b.bottom>0&&(d=Math.min(f(a),b.bottom)),b.left>=0?h=Math.min(b.width,g(a)-b.left):b.left<0&&b.right>0&&(h=Math.min(g(a),b.right));var i=d*h/(b.height*b.width);return Math.max(i,0)},c}),function(a,b){"use strict";a.VISSENSE=b(a,document,a.VISSENSE||{})}(this,function(a,b,c){"use strict";function d(){return(new Date).getTime()}function e(b,g){var h=this;if(!c.iSupported(),!b||1!==b.nodeType)throw new Error("InvalidArgument: no dom element");var i=null,j=[],k={visGte50:!1},l=null,m=function(a){h.config={fullyVisibleThreshold:1,visibleUpdateInterval:100,hiddenUpdateInterval:1e3},a.fullyVisibleThreshold>.1&&(h.config.fullyVisibleThreshold=a.fullyVisibleThreshold),a.visibleUpdateInterval>0&&(h.config.visibleUpdateInterval=a.visibleUpdateInterval),a.hiddenUpdateInterval>0&&(h.config.hiddenUpdateInterval=a.hiddenUpdateInterval)},n=function(b,d){h.element=b,h.d=b.ownerDocument,h.w="defaultView"in h.d?h.d.defaultView:h.d.parentWindow,m(d);var e=["DOMContentLoaded","load","scroll","resize"];for(var f in e)c.addEvent(a,e[f],h._update);h.every(h.config.visibleUpdateInterval,h.config.hiddenUpdateInterval,function(){h._update()}),h.onVisibilityPercentageChange(function(){1!==i.vs50&&(k.visGte50=h._status("visibilityPercentage")>=.5,k.visGte50?l=setTimeout(function(){k.visGte50&&(i.vs50=1,o())},950):clearTimeout(l))}),h._update()},o=function(){for(var a in j)j[a].call(h)},p=function(){return h.isHidden()?e.STATES.HIDDEN:h.isFullyVisible()?e.STATES.FULLY_VISIBLE:e.STATES.VISIBLE},q=function(){var a=i?{ts:i.ts,state:i.state,visibilityPercentage:i.visibilityPercentage}:null;i=i||{},i.prev=a;var b=d();if(i.ts=b,i.state=p(),i.visibilityPercentage=h.getCurrentVisibilityPercentage(),i.prev){var c=b-i.prev.ts;i.time+=c,i.timeVisibleRelative+=c*i.visibilityPercentage,i.prev.state!==e.STATES.HIDDEN&&(i.timeVisible+=c),i.prev.state===e.STATES.FULLY_VISIBLE&&(i.timeFullyVisible+=c)}else i.time=0,i.timeVisible=0,i.timeFullyVisible=0,i.timeVisibleRelative=0,i.vs50=0;return i};this.register=function(a){f+=1;var b=f;return j[b]=a,b},this.unbind=function(a){delete j[a]},this._update=function(){q(),o()},this._status=function(a){return i[a]},n(b,g||{})}c.iSupported=function(){return c.IE_VERSION&&c.IE_VERSION<7?!1:!0};var f=-1;return e.STATES={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2},e.prototype.destroy=function(){},e.prototype.clientHeight=function(){return this.w.innerHeight||this.d.documentElement.clientHeight},e.prototype.clientWidth=function(){return this.w.innerWidth||this.d.documentElement.clientWidth},e.prototype.getTimeVisible=function(){return this._status("timeVisible")},e.prototype.getTimeFullyVisible=function(){return this._status("timeFullyVisible")},e.prototype.getTimeVisibleRelative=function(){return this._status("timeVisibleRelative")},e.prototype.getVisibleRate=function(){return this.getTimeVisible()/this.getDuration()},e.prototype.getFullyVisibleRate=function(){return this.getTimeFullyVisible()/this.getDuration()},e.prototype.getDuration=function(){return this._status("time")},e.prototype.getFullyVisibleThreshold=function(){return Math.max(Math.min(this.config.fullyVisibleThreshold,1),.1)},e.prototype.hasVisibilityChanged=function(){var a=this._status("prev");return!!a&&a.state!==this._status("state")},e.prototype.hasVisibilityPercentageChanged=function(){var a=this._status("prev"),b=this._status("visibilityPercentage");return!a||a.visibilityPercentage!==b},e.prototype.isFullyVisible=function(){return this.isFullyInViewport()&&this.isVisibleByStyling()},e.prototype.isVisible=function(){return this.isInViewport()&&this.isVisibleByStyling()},e.prototype.wasAtLeast50PercentVisibleFor1Second=function(){return 1===this._status("vs50")},e.prototype.isHidden=function(){return!this.isVisible()},e.prototype.isVisibleByStyling=function(){return c.isVisibleByStyling(this.element)},e.prototype.isFullyInViewport=function(){var a=this.getFullyVisibleThreshold();return 1>a?this.getCurrentVisibilityPercentage()>=a:c.isFullyInViewport(this.element)},e.prototype.isInViewport=function(){return c.isInViewport(this.element)},e.prototype.getCurrentVisibilityPercentage=function(){return this.isHidden()?0:c.getVisibilityPercentage(this.element)},c.Vissense=e,c}),function(a){"use strict";var b=function(a){function b(a,b){return function(){a()&&b()}}var c=!1;a.prototype.fireIf50PercentRulePassed=function(a){var d=this;return b(function(){return!c&&d.wasAtLeast50PercentVisibleFor1Second()},function(){a(),c=!0})},a.prototype.fireIfVisibilityChanged=function(a){var c=this;return b(function(){return c.hasVisibilityChanged()},a)},a.prototype.fireIfVisibilityPercentageChanged=function(a){var c=this;return b(function(){return c.hasVisibilityPercentageChanged()},a)},a.prototype.fireIfFullyVisible=function(a){var c=this;return b(function(){return c.isFullyVisible()},a)},a.prototype.fireIfVisible=function(a){var c=this;return b(function(){return c.isVisible()},a)},a.prototype.fireIfHidden=function(a){var c=this;return b(function(){return c.isHidden()},a)},a.prototype.onVisibilityChange=function(a){var b=this.fireIfVisibilityChanged(a);return this.register(b)},a.prototype.on50PercentRulePassed=function(a){var b=this.fireIf50PercentRulePassed(a);return this.register(b)},a.prototype.onVisibilityPercentageChange=function(a){var b=this.fireIfVisibilityPercentageChanged(a);return this.register(b)},a.prototype.onVisible=function(c){var d=this,e=this.fireIfVisibilityChanged(b(function(){var b=d._status("prev");return!b||b.state===a.STATES.HIDDEN},this.fireIfVisible(c)));return this.register(e)},a.prototype.onFullyVisible=function(a){var b=this.fireIfVisibilityChanged(this.fireIfFullyVisible(a));return this.register(b)},a.prototype.onHidden=function(a){var b=this.fireIfVisibilityChanged(this.fireIfHidden(a));return this.register(b)}};b(a.VISSENSE.Vissense)}(window),function(a){"use strict";var b=-1,c=function(c){c.prototype.every=function(a,c,d,e){this._time(),d||(d=c,c=null),b+=1;var f=b;return this._timers[f]={visible:a,hidden:c,callback:d},this._run(f,!!e),f},c.prototype.stop=function(a){return this._timers[a]?(this._cancel(a),delete this._timers[a],!0):!1},c.prototype._time=function(){if(!this._timed){this._timers||(this._timers={}),this._timed=!0;var a=this;this.onVisible(function(){a._cancelAndReinitialize()}),this.onHidden(function(){a._cancelAndReinitialize()})}},c.prototype._run=function(b,c){var d,e=this._timers[b];if(this.isHidden()){if(null===e.hidden)return;d=e.hidden}else d=e.visible;var f=function(){e.last=new Date,e.callback.call(a)};if(c){var g=new Date,h=g-e.last;d>h?e.delay=setTimeout(function(){f(),e.id=setInterval(f,d)},d-h):(f(),e.id=setInterval(f,d))}else e.id=setInterval(f,d)},c.prototype._cancel=function(a){var b=this._timers[a];clearInterval(b.id),clearTimeout(b.delay),delete b.id,delete b.delay},c.prototype._cancelAndReinitialize=function(){var a=this._status("prev"),b=this._status("state"),d=b===c.STATES.HIDDEN,e=!!a&&a.state===c.STATES.HIDDEN;if(d&&!e||!d&&e)for(var f in this._timers)this._cancel(f),this._run(f,!d)}};c(a.VISSENSE.Vissense)}(window);