!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.vissense=e():t.vissense=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){return new i(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(9),u=n(23),s=n(24),a=n(25),c=n(26),f=n(27),l=n(8);i.prototype.monitor=function(t){return new f(this,t)},u.CompositeStrategy=s,u.PollingStrategy=a,u.EventStrategy=c,f.Strategy=u,r.Utils=o,r.VisMon=f,r.VisState=l,r.of=function(t,e){return r(t,e)},r.fn=i.prototype,e["default"]=r,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),u=n(4),s=n(5),a=n(6).percentage,c=n(6).createVisibilityApi,f=n(8),l=function(){function t(e,n){if(r(this,t),!(this instanceof t))return new t(e,n);if(!s(e))throw new Error("not an element node");this._element=e,this._config=o(n,{fullyvisible:1,hidden:0,referenceWindow:window,percentageHook:a,precision:3,visibilityHooks:[]});var i=this._config.precision<=0?1:Math.pow(10,this._config.precision||3);this._round=function(t){return Math.round(t*i)/i};var u=c(this._config.referenceWindow);this._config.visibilityHooks.push(function(){return!u.isHidden()})}return i(t,[{key:"element",value:function(){return this._element}},{key:"referenceWindow",value:function(){return this._config.referenceWindow}},{key:"isFullyVisible",value:function(){return this.state().fullyvisible}},{key:"isVisible",value:function(){return this.state().visible}},{key:"isHidden",value:function(){return this.state().hidden}},{key:"percentage",value:function(){return this.state().percentage}},{key:"state",value:function(){var t=this,e=u(this._config.visibilityHooks,function(e){return e(t._element)?void 0:f.hidden(0)},this);return e||function(t,e,n){var r=t._round(n.percentageHook(e,n.referenceWindow));return r<=n.hidden?f.hidden(r):r>=n.fullyvisible?f.fullyvisible(r):f.visible(r)}(this,this._element,this._config)}}]),t}();e["default"]=l,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){var n=i(e),r=i(t);return n||r?n&&r?(Object.keys(e).forEach(function(n){void 0===t[n]&&(t[n]=e[n])}),t):n?e:t:e}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(3);t.exports=e["default"]},function(t,e){"use strict";function n(t){var e=typeof t;return"function"===e||t&&"object"===e||!1}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t,e,n){for(var r=0,i=t.length;i>r;r++){var o=e.call(n,t[r],r,t);if(void 0!==o)return o}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t){return t&&1===t.nodeType||!1}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){var e=t||window;return{height:e.innerHeight,width:e.innerWidth}}function i(t,e){return(e||window).getComputedStyle(t,null)}function o(t,e){return t.getPropertyValue(e)}function u(t,e){for(var n=!0;n;){var r=t,u=e;n=!1,u||(u=i(r));var s=o(u,"display");if("none"===s)return!1;var a=r.parentNode;if(!d(a))return!0;t=a,e=void 0,n=!0,s=a=void 0}}function s(t,e){if(t===(e||window).document)return!0;if(!t||!t.parentNode)return!1;var n=i(t,e),r=o(n,"visibility");return"hidden"===r||"collapse"===r?!1:u(t,n)}function a(t,e){return!t||t.width<=0||t.height<=0?!1:t.bottom>0&&t.right>0&&t.top<e.height&&t.left<e.width}function c(t,e){var n=t.getBoundingClientRect(),i=r(e);if(!a(n,i)||!s(t))return 0;var o=0,u=0;return n.top>=0?o=Math.min(n.height,i.height-n.top):n.bottom>0&&(o=Math.min(i.height,n.bottom)),n.left>=0?u=Math.min(n.width,i.width-n.left):n.right>0&&(u=Math.min(i.width,n.right)),o*u/(n.height*n.width)}function f(t){return function(t,e){var n=function(t,e){return{property:t,event:e}},r="visibilitychange",i=[n("webkitHidden","webkit"+r),n("msHidden","ms"+r),n("mozHidden","moz"+r),n("hidden",r)],o=p(i,function(n){return t[n.property]!==e?{isHidden:function(){return!!t[n.property]||!1},onVisibilityChange:function(e){return t.addEventListener(n.event,e,!1),function(){return t.removeEventListener(n.event,e,!1)}}}:void 0});return o||{isHidden:function(){return!1},onVisibilityChange:function(){return v}}}((t||window).document)}function l(t){return!f(t||window).isHidden()}Object.defineProperty(e,"__esModule",{value:!0}),e.viewport=r,e.computedStyle=i,e.styleProperty=o,e.isDisplayed=u,e.isVisibleByStyling=s,e.isInViewport=a,e.percentage=c,e.createVisibilityApi=f,e.isPageVisible=l;var p=n(4),d=n(5),v=n(7)},function(t,e){"use strict";function n(){}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t,e,n){return n&&delete n.previous,{code:t[0],state:t[1],percentage:e,previous:n||{},fullyvisible:t[0]===r.FULLY_VISIBLE[0],visible:t[0]===r.VISIBLE[0]||t[0]===r.FULLY_VISIBLE[0],hidden:t[0]===r.HIDDEN[0]}}Object.defineProperty(e,"__esModule",{value:!0});var r={HIDDEN:[0,"hidden"],VISIBLE:[1,"visible"],FULLY_VISIBLE:[2,"fullyvisible"]};e["default"]={hidden:function(t,e){return n(r.HIDDEN,t,e)},visible:function(t,e){return n(r.VISIBLE,t,e)},fullyvisible:function(t,e){return n(r.FULLY_VISIBLE,t,e)}},t.exports=e["default"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),i=n(12),o=n(2),u=n(11),s=n(13),a=n(15),c=n(16),f=n(17),l=n(5),p=n(18),d=n(14),v=n(19),h=n(3),y=n(7),b=n(20),_=n(21),g=n(4),w=n(22),O=n(6),m=O.percentage,j=O.viewport,P=O.isInViewport,x=O.isDisplayed,k=O.styleProperty,E=O.computedStyle,M=O.isVisibleByStyling,S=O.isPageVisible,V=O.createVisibilityApi;e["default"]={async:r,debounce:i,defaults:o,defer:u,extend:s,forEach:g,identity:a,isArray:c,isDefined:f,isElement:l,isFriendlyIframeContext:p,isFunction:d,isIframeContext:v,isObject:h,noop:y,now:b,once:_,throttle:w,VisibilityApi:V(),createVisibilityApi:V,isPageVisible:S,isVisibleByStyling:M,percentage:m,_viewport:j,_isInViewport:P,_isDisplayed:x,_computedStyle:E,_styleProperty:k},t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){return function(){var n=arguments;return i(function(){return t.apply(void 0,n)},e||0)}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(11);t.exports=e["default"]},function(t,e){"use strict";function n(t,e){var n=setTimeout(t,e||0);return function(){clearTimeout(n)}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){var n=this,r=arguments,u=o;return function(){var o=n,s=r;u(),u=i(function(){t.apply(o,s)},e)}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(11),o=n(7);t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e,n){for(var r=-1,o=Object.keys(e),u=o.length,s=i(n);++r<u;){var a=o[r];t[a]=s?n(t[a],e[a],a,t,e):e[a]}return t}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(14);t.exports=e["default"]},function(t,e){"use strict";function n(t){return"function"==typeof t||!1}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t){return t}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"number"==typeof t.length&&"[object Array]"===Object.prototype.toString.call(t)||!1}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t){return void 0!==t}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){try{if(!i(t))return!1;var e=t.self.location,n=t.top.location;return e.protocol===n.protocol&&e.host===n.host&&e.port===n.port}catch(r){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(19);t.exports=e["default"]},function(t,e){"use strict";function n(t){try{return t.self!==t.top}catch(e){return!0}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(){return(new Date).getTime()}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e){"use strict";function n(t){var e,n=arguments,r=!1;return function(){return r||(e=t.apply(void 0,n),r=!0),e}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e,n){var r=arguments,s=o,a=!1;return function(){var o=u(),c=r,f=function(){a=o,t.apply(n,c)};a&&a+e>o?(s(),s=i(f,e)):(a=o,i(f,0))}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r;var i=n(11),o=n(7),u=n(20);t.exports=e["default"]},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){n(this,t)}return r(t,[{key:"init",value:function(t){}},{key:"start",value:function(t){}},{key:"stop",value:function(t){}}]),t}();e["default"]=i,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var i=t,o=e,u=n;r=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var a=s.get;if(void 0===a)return;return a.call(u)}var c=Object.getPrototypeOf(i);if(null===c)return;t=c,e=o,n=u,r=!0,s=c=void 0}},s=n(23),a=n(16),c=n(14),f=function(t){function e(t){r(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this._strategies=t?a(t)?t:[t]:[]}return i(e,t),o(e,[{key:"init",value:function(t){this._strategies.filter(function(t){return c(t.init)}).forEach(function(e){return e.init(t)})}},{key:"start",value:function(t){this._strategies.filter(function(t){return c(t.start)}).forEach(function(e){return e.start(t)})}},{key:"stop",value:function(t){this._strategies.filter(function(t){return c(t.stop)}).forEach(function(e){return e.stop(t)})}}]),e}(s);e["default"]=f,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var i=t,o=e,u=n;r=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var a=s.get;if(void 0===a)return;return a.call(u)}var c=Object.getPrototypeOf(i);if(null===c)return;t=c,e=o,n=u,r=!0,s=c=void 0}},s=n(23),a=n(2),c=function(t){function e(t){r(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this._config=a(t,{interval:1e3}),this._started=!1}return i(e,t),o(e,[{key:"start",value:function(t){if(!this._started){var e=setInterval(function(){return t.update()},this._config.interval);this._clearInterval=function(){return clearInterval(e)},this._started=!0}return this._started}},{key:"stop",value:function(){return this._started?(this._clearInterval(),this._started=!1,!0):!1}}]),e}(s);e["default"]=c,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t,e,n){for(var r=!0;r;){var i=t,o=e,u=n;r=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var a=s.get;if(void 0===a)return;return a.call(u)}var c=Object.getPrototypeOf(i);if(null===c)return;t=c,e=o,n=u,r=!0,s=c=void 0}},s=n(23),a=n(2),c=n(22),f=n(6).createVisibilityApi,l=function(t){function e(t){r(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this._config=a(t,{throttle:50}),this._config.debounce>0&&(this._config.throttle=+this._config.debounce),this._started=!1}return i(e,t),o(e,[{key:"start",value:function(t){return this._started||(this._removeEventListeners=function(e){var n=t.visobj().referenceWindow(),r=f(n),i=r.onVisibilityChange(e);return n.addEventListener("scroll",e,!1),n.addEventListener("resize",e,!1),n.addEventListener("touchmove",e,!1),function(){n.removeEventListener("touchmove",e,!1),n.removeEventListener("resize",e,!1),n.removeEventListener("scroll",e,!1),i()}}(c(function(){return t.update()},this._config.throttle)),this._started=!0),this._started}},{key:"stop",value:function(){return this._started?(this._removeEventListeners(),this._started=!1,!0):!1}}]),e}(s);e["default"]=l,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var n=t.state(),r=n.percentage;return e&&r===e.percentage&&e.percentage===e.previous.percentage?e:n.hidden?v.hidden(r,e):n.fullyvisible?v.fullyvisible(r,e):v.visible(r,e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(11),s=n(2),a=n(13),c=n(4),f=n(16),l=n(14),p=n(20),d=n(28),v=n(8),h=n(24),y=n(25),b=n(26),_=function(){function t(e,n){r(this,t);var i=s(n,{strategy:[new y,new b],async:!1});this._visobj=e,this._state={},this._started=!1;var o="*#"+p();this._pubsub=new d({async:i.async,anyTopicName:o}),this._events=[o,"start","stop","update","hidden","visible","fullyvisible","percentagechange","visibilitychange"],this._strategy=new h(i.strategy),this._strategy.init(this),this._pubsub.on("update",function(t){var e=t._state.percentage,n=t._state.previous.percentage;e!==n&&t._pubsub.publish("percentagechange",[t,e,n])}),this._pubsub.on("update",function(t){t._state.code!==t._state.previous.code&&t._pubsub.publish("visibilitychange",[t])}),this._pubsub.on("visibilitychange",function(t){t._state.visible&&!t._state.previous.visible&&t._pubsub.publish("visible",[t])}),this._pubsub.on("visibilitychange",function(t){t._state.fullyvisible&&t._pubsub.publish("fullyvisible",[t])}),this._pubsub.on("visibilitychange",function(t){t._state.hidden&&t._pubsub.publish("hidden",[t])}),c(this._events,function(t){l(i[t])&&this.on(t,i[t])},this)}return o(t,[{key:"visobj",value:function(){return this._visobj}},{key:"publish",value:function(t,e){var n=this._events.indexOf(t)>=0;if(n)throw new Error('Cannot publish internal event "'+t+'" from external scope.');return this._pubsub.publish(t,e)}},{key:"state",value:function(){return this._state}},{key:"start",value:function(t){if(this._started)return this;var e=s(t,{async:!1});return this._cancelAsyncStart&&this._cancelAsyncStart(),e.async?this.startAsync():(this._started=!0,this.update(),this._pubsub.publish("start",[this]),this._strategy.start(this),this)}},{key:"startAsync",value:function(t){var e=this;this._cancelAsyncStart&&this._cancelAsyncStart();var n=u(function(){return e.start(a(s(t,{}),{async:!1}))});return this._cancelAsyncStart=function(){n(),e._cancelAsyncStart=null},this}},{key:"stop",value:function(){this._cancelAsyncStart&&this._cancelAsyncStart(),this._started&&(this._strategy.stop(this),this._pubsub.publish("stop",[this])),this._started=!1}},{key:"update",value:function(){this._started&&(this._state=i(this._visobj,this._state),this._pubsub.publish("update",[this]))}},{key:"on",value:function(t,e){return this._pubsub.on(t,e)}}]),t}();_.Builder=function(){var t=function(t,e){var n=null,r=t.strategy===!1,i=!r&&(t.strategy||e.length>0);if(i){var o=!!t.strategy,u=f(t.strategy),s=o?u?t.strategy:[t.strategy]:[];n=s.concat(e)}else n=r?[]:t.strategy;return n};return function(e){var n={},r=[],i=[],o=!1,u=null;return{set:function(t,e){return n[t]=e,this},strategy:function(t){return r.push(t),this},on:function(t,e){return i.push([t,e]),this},build:function(s){var a=function(){var s=t(n,r);n.strategy=s;var a=e.monitor(n);return c(i,function(t){return a.on(t[0],t[1])}),o=!0,u=a},f=o?u:a();return l(s)?s(f):f}}}}(),e["default"]=_,t.exports=e["default"]},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(14),u=n(2),s=n(10),a=n(7),c=function(t,e){return t.forEach(function(t){return t(e)})},f=function(){function t(e){r(this,t),this._cache={},this._onAnyCache=[],this._config=u(e,{async:!1,anyTopicName:"*"})}return i(t,[{key:"on",value:function(t,e){if(!o(e))return a;var n=function(t){return e.apply(void 0,t||[])},r=this._config.async?s(n):n,i=function(t,e,n){return function(){var n=e.indexOf(t);return n>-1?(e.splice(n,1),!0):!1}};return t===this._config.anyTopicName?(this._onAnyCache.push(r),i(r,this._onAnyCache,"*")):(this._cache[t]||(this._cache[t]=[]),this._cache[t].push(r),i(r,this._cache[t],t))}},{key:"publish",value:function(t,e){var n=(this._cache[t]||[]).concat(t===this._config.anyTopicName?[]:this._onAnyCache),r=!!this._config.async,i=null;return(i=r?s(c):function(t,e){return c(t,e),a})(n,e||[])}}]),t}();e["default"]=f,t.exports=e["default"]}])});