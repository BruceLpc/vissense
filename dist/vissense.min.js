/*! { "name": "vissense", "version": "0.1.3", "copyright": "(c) 2014 tbk" } */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.VisSense=b()}(this,function(a){"use strict";function b(a){var b=a&&a.ownerDocument;return b?b.defaultView||b.parentWindow:window}function c(b,c){return function(){return(j(b)?b():b)?c():a}}function d(a,b,c){for(var d=-1,e=Object.keys(b),f=e.length;++d<f;){var g=e[d];a[g]=c?c(a[g],b[g],g,a,b):b[g]}return a}function e(){}function f(a){return a}function g(){return(new Date).getTime()}function h(a){return window.setTimeout(function(){a()},0)}function i(a){return a===Object(a)}function j(a){return"function"==typeof a}function k(a,b){if(!i(a))return b;for(var c=Object.keys(b),d=0,e=c.length;e>d;d++){var f=c[d];void 0===a[f]&&(a[f]=b[f])}return a}function l(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function m(b){var c=b.getBoundingClientRect();return c.height===a||c.width===a?d({height:b.clientHeight,width:b.clientWidth},c):c}function n(c){var d=c?b(c):window;return d.innerWidth===a?{height:d.document.documentElement.clientHeight,width:d.document.documentElement.clientWidth}:{height:d.innerHeight,width:d.innerWidth}}function o(a){if(!a.offsetParent){var b=p(a,"position");if("fixed"!==b)return!1}return!0}function p(c,d,e){if(c.style!==a){var f=e||b(c),g=f.getComputedStyle(c,null);return g&&g.getPropertyValue(d)}}function q(a){var c=p(a,"display",b(a));if("none"===c)return!1;var d=p(a,"visibility",b(a));return"hidden"===d||"collapse"===d?!1:a.parentNode&&a.parentNode.style?q(a.parentNode):!0}function r(a){if(a===b(a).document)return!0;if(!a||!a.parentNode)return!1;if(!o(a))return!1;var c=q(a);return c!==!0?!1:!0}function s(a,b){return!a||a.width<=0||a.height<=0?!1:a.bottom>0&&a.right>0&&a.top<b.height&&a.left<b.width}function t(a){if(!u())return 0;var b=m(a),c=n(a);if(!s(b,c)||!r(a))return 0;var d=0,e=0;return b.top>=0?d=Math.min(b.height,c.height-b.top):b.bottom>0&&(d=Math.min(c.height,b.bottom)),b.left>=0?e=Math.min(b.width,c.width-b.left):b.right>0&&(e=Math.min(c.width,b.right)),Math.round(d*e/(b.height*b.width)*1e3)/1e3}function u(){return B?!document[B[0]]:!0}function v(a,b){if(!(this instanceof v))return new v(a,b);if(!a||1!==a.nodeType)throw new Error("not an element node");this._element=a,this._config=k(b,{fullyvisible:1,hidden:0})}function w(a,b){var c=a.state(),d=c.percentage;return b&&d===b.percentage()&&!b.hasPercentageChanged()?b:c.hidden?v.VisState.hidden(d,b):c.fullyvisible?v.VisState.fullyvisible(d,b):v.VisState.visible(d,b)}function x(a,b){for(var c=Object.keys(a),d=0,e=c.length;e>d;d++)a[d].call(b||window)}function y(a,b){var c=this,d=k(b,{strategy:new y.Strategy.NoopStrategy});c._visobj=a,c._lastListenerId=-1,c._status=null,c._listeners={},c._strategy=d.strategy,c._events=["update","hidden","visible","fullyvisible","percentagechange","visibilitychange"];for(var e=0,f=c._events.length;f>e;e++)d[c._events[e]]&&c.on(c._events[e],d[c._events[e]])}function z(a,b,c){this._state=a,this._percentage=b,this._prev=c}function A(a,b,c){return c&&(delete c._prev,c.prev=e),new z(a,b,c)}var B=function(a){for(var b="visibilitychange",c=[["hidden",b],["mozHidden","moz"+b],["webkitHidden","webkit"+b],["msHidden","ms"+b]],d=0,e=c.length;e>d;d++)if(document[c[d][0]]!==a)return c[d]}();v.prototype.state=function(){var a=this.percentage();return{percentage:a,hidden:a<=this._config.hidden,visible:a>this._config.hidden,fullyvisible:a>=this._config.fullyvisible}},v.prototype.percentage=function(){return t(this._element)},v.prototype.isFullyVisible=function(){return this.state().fullyvisible},v.prototype.isVisible=function(){return this.state().visible},v.prototype.isHidden=function(){return this.state().hidden},v.prototype.fireIfFullyVisible=function(a){var b=this;return c(function(){return b.isFullyVisible()},a)},v.prototype.fireIfVisible=function(a){var b=this;return c(function(){return b.isVisible()},a)},v.prototype.fireIfHidden=function(a){var b=this;return c(function(){return b.isHidden()},a)},v.fn=v.prototype,v.of=function(a,b){return new v(a,b)},y.prototype.visobj=function(){return this._visobj},y.prototype.status=function(){return this._status},y.prototype.start=function(){return this._strategy.start(this),this},y.prototype.stop=function(){return this._strategy.stop(this)},y.prototype.use=function(a){this._strategy.stop(),this._strategy=a,this._strategy.start(this)},y.prototype.onUpdate=function(b){return j(b)?(this._lastListenerId+=1,this._listeners[this._lastListenerId]=b.bind(a,this),this._lastListenerId):-1},y.prototype.update=function(){this._status=w(this._visobj,this._status),x(this._listeners,this)},y.prototype.fireIfVisibilityChanged=function(a){var b=this;return c(function(){return b._status.hasVisibilityChanged()},a)},y.prototype.fireIfPercentageChanged=function(a){var b=this;return c(function(){return b._status.hasPercentageChanged()},a)},y.prototype.onVisibilityChange=function(a){return this.onUpdate(this.fireIfVisibilityChanged(a))},y.prototype.onPercentageChange=function(a){var b=this;return this.onUpdate(this.fireIfPercentageChanged(function(){var c=b.status(),d=c.prev();a(c.percentage(),d&&d.percentage(),b)}))},y.prototype.onVisible=function(a){var b=this,d=c(function(){return b._status.isVisible()},a),e=b.fireIfVisibilityChanged(c(function(){return!b._status.prev()||b._status.wasHidden()},d));return b.onUpdate(e)},y.prototype.onFullyVisible=function(a){var b=this,d=c(function(){return b._status.isFullyVisible()},a),e=b.fireIfVisibilityChanged(d);return b.onUpdate(e)},y.prototype.onHidden=function(a){var b=this,d=c(function(){return b._status.isHidden()},a),e=b.fireIfVisibilityChanged(d);return b.onUpdate(e)},y.prototype.on=function(a,b){var c=this;switch(a){case"update":return c.onUpdate(b);case"hidden":return c.onHidden(b);case"visible":return c.onVisible(b);case"fullyvisible":return c.onFullyVisible(b);case"percentagechange":return c.onPercentageChange(b);case"visibilitychange":return c.onVisibilityChange(b)}return-1};var C={HIDDEN:0,VISIBLE:1,FULLY_VISIBLE:2};return z.prototype.isVisible=function(){return this._state===C.VISIBLE||this.isFullyVisible()},z.prototype.isFullyVisible=function(){return this._state===C.FULLY_VISIBLE},z.prototype.isHidden=function(){return this._state===C.HIDDEN},z.prototype.state=function(){return this._state},z.prototype.wasVisible=function(){return!!this._prev&&this._prev.isVisible()},z.prototype.wasFullyVisible=function(){return!!this._prev&&this._prev.isFullyVisible()},z.prototype.wasHidden=function(){return!!this._prev&&this._prev.isHidden()},z.prototype.hasVisibilityChanged=function(){return!this._prev||this._state!==this._prev._state},z.prototype.prev=function(){return this._prev},z.prototype.hasPercentageChanged=function(){return!this._prev||this._percentage!==this._prev._percentage},z.prototype.percentage=function(){return this._percentage},y.Strategy=function(){},y.Strategy.prototype.start=function(){throw new Error("Strategy#start needs to be overridden.")},y.Strategy.prototype.stop=function(){throw new Error("Strategy#stop needs to be overridden.")},y.Strategy.NoopStrategy=function(){},y.Strategy.NoopStrategy.prototype=Object.create(y.Strategy.prototype),y.Strategy.NoopStrategy.prototype.start=function(a){a.update()},y.Strategy.NoopStrategy.prototype.stop=function(){},y.Strategy.PollingStrategy=function(a){this._config=k(a,{interval:1e3}),this._started=!1},y.Strategy.PollingStrategy.prototype=Object.create(y.Strategy.prototype),y.Strategy.PollingStrategy.prototype.start=function(a){var b=this;return c(!b._started,function(){b.stop(),b._update=function(){a.update()},addEventListener("visibilitychange",b._update),function c(){a.update(),b._timer=setTimeout(c,b._config.interval)}(),b._started=!0})(),b._started},y.Strategy.PollingStrategy.prototype.stop=function(){var a=this;return a._started?(clearTimeout(a._timer),removeEventListener("visibilitychange",a._update),a._started=!1,!0):!1},y.Strategy.EventStrategy=function(a){this._config=k(a,{debounce:30}),this._started=!1},y.Strategy.EventStrategy.prototype=Object.create(y.Strategy.prototype),y.Strategy.EventStrategy.prototype.start=function(a){var b=this;return c(!b._started,function(){b.stop(),b._update=l(function(){a.update()},b._config.debounce),addEventListener("visibilitychange",b._update),addEventListener("scroll",b._update),addEventListener("resize",b._update),b._update(),b._started=!0})(),this._started},y.Strategy.EventStrategy.prototype.stop=function(){var a=this;return a._started?(removeEventListener("resize",a._update),removeEventListener("scroll",a._update),removeEventListener("visibilitychange",a._update),a._started=!1,!0):!1},v.VisMon=y,v.fn.monitor=function(a){return new y(this,a)},v.VisState={hidden:function(a,b){return A(C.HIDDEN,a,b||null)},visible:function(a,b){return A(C.VISIBLE,a,b||null)},fullyvisible:function(a,b){return A(C.FULLY_VISIBLE,a,b||null)}},v.Utils={fireIf:c,noop:e,identity:f,isObject:i,isFunction:j,defaults:k,extend:d,now:g,defer:h,debounce:l,isPageVisible:u,percentage:t,isVisibleByStyling:r,_window:b,_viewport:n,_isInViewport:s,_getBoundingClientRect:m,_isDisplayed:q,_findEffectiveStyleProperty:p},v});
//# sourceMappingURL=vissense.min.js.map